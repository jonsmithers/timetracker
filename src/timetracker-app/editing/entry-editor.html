<link rel="import" href="../../../bower_components/polymer/polymer.html">
<link rel="import" href="../../../bower_components/paper-toast/paper-toast.html">
<link rel="import" href="./time-picker.html">
<link rel="import" href="./time-field.html">
<dom-module id="entry-editor">
    <template>
      <style>
        .horizontalFlexLayout {
          display: flex;
        }
        .horizontalFlexLayout > * {
          flex-grow: 1;
          flex-basis: 50vw;
        }
      </style>
      <div class="horizontalFlexLayout">
        <paper-item>
          [[_computeDay(entry.startTime)]]
        </paper-item>
        <paper-item on-tap="_editStartTime">
          [[_computeTime(entry.startTime)]]
        </paper-item>
      </div>
      <div class="horizontalFlexLayout">
        <paper-item>
          [[_computeDay(entry.stopTime)]]
        </paper-item>
        <paper-item on-tap="_editStopTime">
          [[_computeTime(entry.stopTime)]]
        </paper-item>
      </div>
      <time-picker id="timePicker"></time-picker>
      <paper-toast id="errorPaperToast"></paper-toast>
    </template>

    <script>
      Polymer({
        is: "entry-editor",

        properties: {
          entry: Object,
        },

        _computeDay: function(m) {
          return m.format("dddd, MMMM DD");
        },
        _computeTime: function(m) {
          return m.format("h:mm a");
        },
        _editStopTime: function() {
          this._editTime('stopTime');
        },
        _editStartTime: function() {
          this._editTime('startTime');
        },
        _editTime: function(whichTime) {
          this.$.timePicker.open(this.get(['entry',whichTime])).then(function(m) {

            // validate
            if (whichTime == "startTime" && m.isAfter(this.entry.stopTime)) {
              this.$.errorPaperToast.show({text: "start time is after stop time"});
              return;
            }
            if ("stopTime" == whichTime && m.isBefore(this.entry.startTime)) {
              this.$.errorPaperToast.show({text:"end time is before start time"});
              return;
            }

            this.set(['entry',whichTime], m);

          }.bind(this));
        },
      });
    </script>
</dom-module>
